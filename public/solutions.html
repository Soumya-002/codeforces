<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submitted Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="./Css/solutions.css">
</head>
<body>
    <div class="container">
        <h1>Submitted Solutions</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Enter Problem ID">
            <button onclick="searchSolutions()">Search</button>
        </div>
        <div id="solutions"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        let allSolutions = [];

// Fetch solutions from the server
fetch('/get-solutions')
    .then(response => response.json())
    .then(data => {
        allSolutions = data;
        displaySolutions(allSolutions);
    })
    .catch(error => {
        console.error('Error fetching solutions:', error);
    });

function displaySolutions(solutions) {
    const solutionsDiv = document.getElementById('solutions');
    solutionsDiv.innerHTML = ''; // Clear previous solutions
    if (solutions.length === 0) {
        solutionsDiv.innerHTML = '<p>No solutions found.</p>';
    } else {
        solutions.forEach(solution => {
            const solutionElement = document.createElement('div');
            solutionElement.className = 'solution';
            solutionElement.innerHTML = `
                <h3>Problem ID: ${solution.problemId}</h3>
                <p><strong>User:</strong> ${solution.username}</p>
                <pre><code class="language-javascript">${Prism.highlight(solution.solutionText, Prism.languages.javascript, 'javascript')}</code></pre>
                <p><em>Submitted on: ${new Date(solution.date).toLocaleString()}</em></p>
                <div class="like-section" style="padding-right: 10px;">
                    <i class="fa fa-thumbs-up like-icon" onclick="likeSolution('${solution._id}')"></i>
                    <span style="padding-right: 10px;"id="like-count-${solution._id}">${solution.likes || 0} Likes</span>
                    <i class="fa fa-thumbs-down dislike-icon" onclick="dislikeSolution('${solution._id}')"></i>
                    <span id="dislike-count-${solution._id}">${solution.dislikes || 0} Dislikes</span>
                </div>

                
            `;
            solutionsDiv.appendChild(solutionElement);
            console.log('Solution ID:', solution._id);

        });
    }
}

function likeSolution(solutionId) {
    fetch(`/like-solution/${solutionId}`, {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        const likeCountElement = document.getElementById(`like-count-${solutionId}`);
        if (likeCountElement) {
            likeCountElement.textContent = `${data.likes} Likes`;
            console.log(data.likes);
        }
    })
    .catch(error => {
        console.error('Error liking solution:', error);

        // Log the response text for debugging
        fetch(`/like-solution/${solutionId}`, { method: 'POST' })
            .then(response => response.text())
            .then(text => console.error('Response:', text));
    });
}
function dislikeSolution(solutionId) {
    fetch(`/dislike-solution/${solutionId}`, {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        const dislikeCountElement = document.getElementById(`dislike-count-${solutionId}`);
        if (dislikeCountElement) {
            dislikeCountElement.textContent = `${data.dislikes} Dislikes`;
        }
    })
    .catch(error => console.error('Error disliking solution:', error));
}

function searchSolutions() {
    const searchInput = document.getElementById('searchInput').value.trim();
    if (searchInput) {
        const filteredSolutions = allSolutions.filter(solution => solution.problemId === searchInput);
        displaySolutions(filteredSolutions);
    } else {
        displaySolutions(allSolutions); // Show all if search is empty
    }
}

    </script>
</body>
</html>
